<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics | Auto Capital</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="./firebase-config.js"></script>
<script src="./ac-data.js"></script>
<style>
:root{--bg:#f4f6f9;--bg2:#fff;--bg3:#f0f2f6;--bg4:#eef0f5;--border:#e2e6ed;--border2:#c8d0dc;--red:#C8102E;--red2:#a00d24;--red-light:rgba(200,16,46,.07);--blue:#003DA5;--blue2:#002d7a;--blue-light:rgba(0,61,165,.07);--gold:#d4980a;--green:#1a7f37;--green-light:rgba(26,127,55,.07);--orange:#d4600a;--text:#0f1923;--text2:#3d4d5c;--muted:#7a8fa6;--shadow:0 1px 3px rgba(0,0,0,.07),0 4px 16px rgba(0,0,0,.04);--card-radius:12px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
.header{background:var(--blue);padding:0 32px;height:68px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;box-shadow:0 2px 16px rgba(0,61,165,.25)}
.logo-area{display:flex;align-items:center;gap:16px}
.logo-area img{height:42px;filter:brightness(0) invert(1)}
.logo-divider{width:1px;height:34px;background:rgba(255,255,255,.2)}
.system-name{font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,.8)}
.nav{display:flex;gap:2px}
.nav a{padding:8px 13px;border-radius:7px;font-size:13px;font-weight:500;color:rgba(255,255,255,.72);text-decoration:none;transition:all .18s;display:flex;align-items:center;gap:6px}
.nav a i{font-size:12px}
.nav a:hover{background:rgba(255,255,255,.13);color:#fff}
.nav a.active{background:var(--red);color:#fff;font-weight:700}
.header-right{display:flex;align-items:center;gap:12px}
.user-badge{background:rgba(255,255,255,.15);color:#fff;font-weight:600;font-size:11px;padding:5px 14px;border-radius:20px;letter-spacing:1px;text-transform:uppercase;border:1px solid rgba(255,255,255,.2)}
.btn-logout{background:transparent;border:1px solid rgba(255,255,255,.25);color:rgba(255,255,255,.8);padding:6px 12px;border-radius:7px;cursor:pointer;font-size:12px;font-family:'DM Sans',sans-serif}
.main{max-width:1540px;margin:0 auto;padding:32px}
.page-hdr{margin-bottom:28px;display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:14px}
.page-hdr h1{font-size:28px;font-weight:800;letter-spacing:-.3px}
.page-hdr h1 .r{color:var(--red)}
.page-hdr p{color:var(--muted);font-size:14px;margin-top:4px}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);overflow:hidden;box-shadow:var(--shadow)}
.card-hdr{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-title{font-size:12px;font-weight:700;color:var(--text2);letter-spacing:.5px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
.card-title i{color:var(--blue)}
.card-body{padding:20px}
/* KPI */
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:24px}
.kpi{background:var(--bg2);border:1px solid var(--border);border-radius:var(--card-radius);padding:20px 22px;box-shadow:var(--shadow);position:relative;overflow:hidden;border-top:3px solid var(--kc,var(--blue))}
.kpi-label{font-size:10px;font-weight:700;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-bottom:8px}
.kpi-val{font-size:32px;font-weight:800;line-height:1;color:var(--kc,var(--text))}
.kpi-sub{font-size:12px;color:var(--muted);margin-top:4px}
.kpi-icon{position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:32px;opacity:.06;color:var(--kc,var(--blue))}
/* GRIDS */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:20px}
.g4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:16px;margin-bottom:20px}
.ch-sm{height:180px;position:relative}
.ch-md{height:240px;position:relative}
.ch-lg{height:300px;position:relative}
/* TABLE */
.ac-table{width:100%;border-collapse:collapse;font-size:13px}
.ac-table th{padding:10px 14px;text-align:left;font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:var(--muted);font-weight:700;border-bottom:2px solid var(--border);background:var(--bg3)}
.ac-table td{padding:10px 14px;border-bottom:1px solid var(--border)}
.ac-table tr:last-child td{border-bottom:none}
.ac-table tbody tr:hover td{background:var(--blue-light)}
.reg-plate{font-family:'DM Mono',monospace;font-size:11px;background:#fff9db;color:#7a5c00;padding:2px 7px;border-radius:4px;border:1px solid #e6d080;letter-spacing:1.5px}
.badge{display:inline-flex;align-items:center;padding:3px 9px;border-radius:7px;font-size:11px;font-weight:700}
.b-red{background:var(--red-light);color:var(--red)}
.b-blue{background:var(--blue-light);color:var(--blue)}
.b-green{background:var(--green-light);color:var(--green)}
.b-orange{background:rgba(212,96,10,.08);color:var(--orange)}
.b-grey{background:var(--bg3);color:var(--muted)}
.sec{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin:24px 0 14px;display:flex;align-items:center;gap:10px}
.sec::after{content:'';flex:1;height:1px;background:var(--border)}
.btn{padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;transition:all .2s;display:inline-flex;align-items:center;gap:7px}
.btn-outline{background:transparent;border:1px solid var(--border2);color:var(--text2)}.btn-outline:hover{border-color:var(--blue);color:var(--blue)}
@media(max-width:1200px){.kpi-row{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:1fr 1fr}}
@media(max-width:800px){.g2,.g3{grid-template-columns:1fr}.kpi-row{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<header class="header">
  <div class="logo-area">
    <img src="./autocapital-logo.png" alt="Auto Capital" onerror="this.style.display='none'">
    <div class="logo-divider"></div>
    <span class="system-name">Back Office System</span>
  </div>
  <nav class="nav">
    <a href="./index.html"><i class="fas fa-th-large"></i> Dashboard</a>
    <a href="./inventory.html"><i class="fas fa-car"></i> Inventory</a>
    <a href="./workflow.html"><i class="fas fa-tasks"></i> Workflow</a>
    <a href="./alerts.html"><i class="fas fa-bell"></i> Alerts</a>
    <a href="./analytics.html" class="active"><i class="fas fa-chart-bar"></i> Analytics</a>
    <a href="./marketing.html"><i class="fas fa-chart-line"></i> Marketing</a>
    <a href="./keys.html"><i class="fas fa-key"></i> Keys</a>
    <a href="./team.html"><i class="fas fa-users"></i> Team</a>
    <a href="./admin.html"><i class="fas fa-cog"></i> Admin</a>
  </nav>
  <div class="header-right">
    <span id="userBadge" class="user-badge">Auto Capital</span>
    <button class="btn-logout" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i></button>
  </div>
</header>

<main class="main">
  <div class="page-hdr">
    <div>
      <h1>Stock <span class="r">Analytics</span></h1>
      <p id="dataLine">Loading stock data...</p>
    </div>
    <button class="btn btn-outline" onclick="buildAll()"><i class="fas fa-sync-alt"></i> Refresh</button>
  </div>

  <!-- KPIs -->
  <div class="kpi-row">
    <div class="kpi" style="--kc:var(--blue)"><i class="fas fa-car kpi-icon"></i><div class="kpi-label">Total Stock</div><div class="kpi-val" id="kTotal">—</div><div class="kpi-sub" id="kTotalSub">—</div></div>
    <div class="kpi" style="--kc:var(--green)"><i class="fas fa-check-circle kpi-icon"></i><div class="kpi-label">In Stock</div><div class="kpi-val" id="kInStock">—</div><div class="kpi-sub">Ready to sell</div></div>
    <div class="kpi" style="--kc:var(--red)"><i class="fas fa-pound-sign kpi-icon"></i><div class="kpi-label">Total Value</div><div class="kpi-val" id="kValue">—</div><div class="kpi-sub" id="kAvg">Avg per vehicle</div></div>
    <div class="kpi" style="--kc:var(--orange)"><i class="fas fa-exclamation-triangle kpi-icon"></i><div class="kpi-label">No Price Set</div><div class="kpi-val" id="kNoPrice">—</div><div class="kpi-sub">Need pricing</div></div>
    <div class="kpi" style="--kc:var(--gold)"><i class="fas fa-calendar kpi-icon"></i><div class="kpi-label">MOT Alerts</div><div class="kpi-val" id="kMot">—</div><div class="kpi-sub">Expiring 60 days</div></div>
  </div>

  <!-- ROW 1: 4 mini charts -->
  <div class="sec"><i class="fas fa-chart-pie" style="color:var(--blue)"></i> Stock Breakdown</div>
  <div class="g4" style="margin-bottom:20px">
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-circle-notch"></i> Status</span></div><div class="card-body"><div class="ch-sm"><canvas id="cStatus"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-map-marker-alt"></i> Location</span></div><div class="card-body"><div class="ch-sm"><canvas id="cLocation"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-gas-pump"></i> Fuel Type</span></div><div class="card-body"><div class="ch-sm"><canvas id="cFuel"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-cog"></i> Gearbox</span></div><div class="card-body"><div class="ch-sm"><canvas id="cGearbox"></canvas></div></div></div>
  </div>

  <!-- ROW 2: Makes -->
  <div class="sec"><i class="fas fa-car" style="color:var(--blue)"></i> Make Analysis</div>
  <div class="g2">
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-chart-bar"></i> Top Makes by Volume</span></div><div class="card-body"><div class="ch-md"><canvas id="cMakes"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-pound-sign"></i> Top Makes by Total Value</span></div><div class="card-body"><div class="ch-md"><canvas id="cMakeValue"></canvas></div></div></div>
  </div>

  <!-- ROW 3: Price + Mileage bands -->
  <div class="sec"><i class="fas fa-filter" style="color:var(--blue)"></i> Price & Mileage Distribution</div>
  <div class="g2">
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-chart-area"></i> Stock by Price Band</span></div><div class="card-body"><div class="ch-md"><canvas id="cPrice"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-tachometer-alt"></i> Stock by Mileage Band</span></div><div class="card-body"><div class="ch-md"><canvas id="cMileage"></canvas></div></div></div>
  </div>

  <!-- ROW 4: Age + Body -->
  <div class="sec"><i class="fas fa-info-circle" style="color:var(--blue)"></i> Age & Body Type</div>
  <div class="g2">
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-calendar-alt"></i> Stock Age (Years)</span></div><div class="card-body"><div class="ch-md"><canvas id="cAge"></canvas></div></div></div>
    <div class="card"><div class="card-hdr"><span class="card-title"><i class="fas fa-car-side"></i> Body Type</span></div><div class="card-body"><div class="ch-md"><canvas id="cBody"></canvas></div></div></div>
  </div>

  <!-- MOT TABLE -->
  <div class="sec"><i class="fas fa-exclamation-circle" style="color:var(--red)"></i> MOT Expiry — Next 60 Days</div>
  <div class="card" style="margin-bottom:24px">
    <div style="overflow-x:auto">
      <table class="ac-table">
        <thead><tr><th>Reg</th><th>Make / Model</th><th>MOT Date</th><th>Days Left</th><th>Location</th><th>Price</th></tr></thead>
        <tbody id="motBody"></tbody>
      </table>
    </div>
  </div>

  <!-- NO PRICE TABLE -->
  <div class="sec"><i class="fas fa-tag" style="color:var(--orange)"></i> Vehicles Without a Price</div>
  <div class="card">
    <div style="overflow-x:auto">
      <table class="ac-table">
        <thead><tr><th>Reg</th><th>Make / Model</th><th>Status</th><th>Location</th><th>Fuel</th><th>Mileage</th></tr></thead>
        <tbody id="noPriceBody"></tbody>
      </table>
    </div>
  </div>

</main>

<script>
const vehicles = getVehicles();
const charts = {};

function fmt(n){return new Intl.NumberFormat('en-GB').format(n||0);}
function fmtGBP(n){return new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP',maximumFractionDigits:0}).format(n||0);}
function motDays(s){if(!s)return null;const p=s.split('/');if(p.length!==3)return null;return Math.ceil((new Date(p[2],p[1]-1,p[0]).getTime()-Date.now())/86400000);}
function regYear(s){if(!s)return null;const p=s.split('/');return p.length===3?parseInt(p[2]):null;}

const BLUE='#003DA5', RED='#C8102E', GOLD='#d4980a', GREEN='#1a7f37', ORANGE='#d4600a';
const PALETTE=[BLUE,'#1a56db','#3b82f6','#60a5fa',RED,'#dc2626','#f87171',GOLD,GREEN,ORANGE,'#7c3aed','#0891b2'];

function mkChart(id,type,labels,datasets,opts={}){
  if(charts[id])charts[id].destroy();
  const ctx=document.getElementById(id);if(!ctx)return;
  charts[id]=new Chart(ctx,{type,data:{labels,datasets},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},...opts}});
}

function buildAll(){
  const v=vehicles;
  const withPrice=v.filter(x=>x.price>0);
  const inStock=v.filter(x=>(x.status||'').toLowerCase().includes('in stock'));
  const totalVal=withPrice.reduce((s,x)=>s+(x.price||0),0);
  const noPrice=v.filter(x=>(!x.price||x.price===0)&&x.status!=='Sold');
  const motSoon=v.filter(x=>{const d=motDays(x.mot);return d!==null&&d<=60;});

  document.getElementById('kTotal').textContent=v.length;
  document.getElementById('kTotalSub').textContent=`${withPrice.length} priced`;
  document.getElementById('kInStock').textContent=inStock.length;
  document.getElementById('kValue').textContent=fmtGBP(totalVal);
  document.getElementById('kAvg').textContent=withPrice.length?`Avg ${fmtGBP(totalVal/withPrice.length)}`:'—';
  document.getElementById('kNoPrice').textContent=noPrice.length;
  document.getElementById('kMot').textContent=motSoon.length;
  document.getElementById('dataLine').textContent=`${v.length} vehicles · Last updated ${new Date().toLocaleTimeString('en-GB')}`;

  // STATUS doughnut
  const sc={};v.forEach(x=>{sc[x.status||'Unknown']=(sc[x.status||'Unknown']||0)+1;});
  const sCols={'In Stock':GREEN,'In Transit':ORANGE,'Off-site R':RED,'Subject to':GOLD,'Unknown':'#94a3b8'};
  mkChart('cStatus','doughnut',Object.keys(sc),[{data:Object.values(sc),backgroundColor:Object.keys(sc).map(k=>sCols[k]||'#94a3b8'),borderWidth:2,borderColor:'#fff'}],{cutout:'60%',plugins:{legend:{display:true,position:'bottom',labels:{color:'#3d4d5c',font:{size:10},padding:8,boxWidth:10}}}});

  // LOCATION doughnut
  const lc={};v.forEach(x=>{const l=x.location||'Unknown';lc[l]=(lc[l]||0)+1;});
  mkChart('cLocation','doughnut',Object.keys(lc),[{data:Object.values(lc),backgroundColor:PALETTE,borderWidth:2,borderColor:'#fff'}],{cutout:'60%',plugins:{legend:{display:true,position:'bottom',labels:{color:'#3d4d5c',font:{size:10},padding:8,boxWidth:10}}}});

  // FUEL doughnut
  const fc={};v.forEach(x=>{fc[x.fuel||'Unknown']=(fc[x.fuel||'Unknown']||0)+1;});
  const fCols={Diesel:BLUE,Petrol:RED,Electric:GREEN,'Elec D':GOLD,'Petrol H':'#7c3aed',Unknown:'#94a3b8'};
  mkChart('cFuel','doughnut',Object.keys(fc),[{data:Object.values(fc),backgroundColor:Object.keys(fc).map(k=>fCols[k]||'#94a3b8'),borderWidth:2,borderColor:'#fff'}],{cutout:'60%',plugins:{legend:{display:true,position:'bottom',labels:{color:'#3d4d5c',font:{size:10},padding:8,boxWidth:10}}}});

  // GEARBOX doughnut
  const gc={};v.forEach(x=>{gc[x.gearbox||'Unknown']=(gc[x.gearbox||'Unknown']||0)+1;});
  mkChart('cGearbox','doughnut',Object.keys(gc),[{data:Object.values(gc),backgroundColor:[BLUE,RED,GOLD,GREEN],borderWidth:2,borderColor:'#fff'}],{cutout:'60%',plugins:{legend:{display:true,position:'bottom',labels:{color:'#3d4d5c',font:{size:10},padding:8,boxWidth:10}}}});

  // TOP MAKES by volume
  const mc={};v.forEach(x=>{if(x.make)mc[x.make]=(mc[x.make]||0)+1;});
  const topMakes=Object.entries(mc).sort((a,b)=>b[1]-a[1]).slice(0,10);
  mkChart('cMakes','bar',topMakes.map(m=>m[0]),[{data:topMakes.map(m=>m[1]),backgroundColor:BLUE,borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6',font:{size:11}},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6'},grid:{color:'rgba(0,61,165,.06)'}}}});

  // TOP MAKES by value
  const mv={};v.forEach(x=>{if(x.make&&x.price>0)mv[x.make]=(mv[x.make]||0)+(x.price||0);});
  const topVal=Object.entries(mv).sort((a,b)=>b[1]-a[1]).slice(0,10);
  mkChart('cMakeValue','bar',topVal.map(m=>m[0]),[{data:topVal.map(m=>m[1]),backgroundColor:RED,borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6',font:{size:11}},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6',callback:v=>'£'+Math.round(v/1000)+'k'},grid:{color:'rgba(200,16,46,.06)'}}}});

  // PRICE BANDS
  const bands=['Under £5k','£5–10k','£10–15k','£15–20k','£20–25k','£25k+'];
  const bc=[0,0,0,0,0,0];
  v.filter(x=>x.price>0).forEach(x=>{const p=x.price;if(p<5000)bc[0]++;else if(p<10000)bc[1]++;else if(p<15000)bc[2]++;else if(p<20000)bc[3]++;else if(p<25000)bc[4]++;else bc[5]++;});
  mkChart('cPrice','bar',bands,[{data:bc,backgroundColor:[GREEN,'#22a74a','#2dc45e',GOLD,ORANGE,RED],borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6',font:{size:11}},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6'},grid:{color:'rgba(0,61,165,.06)'}}}});

  // MILEAGE BANDS
  const mb=['0–10k','10–30k','30–50k','50–75k','75–100k','100k+'];
  const mbc=[0,0,0,0,0,0];
  v.forEach(x=>{const m=parseInt(x.mileage)||0;if(m<10000)mbc[0]++;else if(m<30000)mbc[1]++;else if(m<50000)mbc[2]++;else if(m<75000)mbc[3]++;else if(m<100000)mbc[4]++;else mbc[5]++;});
  mkChart('cMileage','bar',mb,[{data:mbc,backgroundColor:[GREEN,GREEN,GOLD,ORANGE,RED,RED].map((c,i)=>i<2?GREEN:i<3?GOLD:i<4?ORANGE:RED),borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6',font:{size:11}},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6'},grid:{color:'rgba(0,61,165,.06)'}}}});

  // AGE
  const now=new Date().getFullYear();
  const ageBands={'2020–Now':0,'2015–2019':0,'2010–2014':0,'Before 2010':0};
  v.forEach(x=>{const y=regYear(x.regDate);if(!y)return;if(y>=2020)ageBands['2020–Now']++;else if(y>=2015)ageBands['2015–2019']++;else if(y>=2010)ageBands['2010–2014']++;else ageBands['Before 2010']++;});
  mkChart('cAge','bar',Object.keys(ageBands),[{data:Object.values(ageBands),backgroundColor:[BLUE,'#1a56db','#60a5fa','#94a3b8'],borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6'},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6'},grid:{color:'rgba(0,61,165,.06)'}}}});

  // BODY TYPE
  const bodyC={};v.forEach(x=>{if(x.body&&x.body!=='Not set')bodyC[x.body]=(bodyC[x.body]||0)+1;});
  const topBody=Object.entries(bodyC).sort((a,b)=>b[1]-a[1]).slice(0,8);
  mkChart('cBody','bar',topBody.map(b=>b[0]),[{data:topBody.map(b=>b[1]),backgroundColor:PALETTE,borderRadius:5,borderSkipped:false}],{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#7a8fa6',font:{size:11}},grid:{display:false}},y:{beginAtZero:true,ticks:{color:'#7a8fa6'},grid:{color:'rgba(0,61,165,.06)'}}}});

  // MOT TABLE
  const motList=v.filter(x=>{const d=motDays(x.mot);return d!==null&&d<=60;}).map(x=>({...x,days:motDays(x.mot)})).sort((a,b)=>a.days-b.days);
  document.getElementById('motBody').innerHTML=motList.map(x=>{
    const d=x.days;
    const [col,lbl]=d<0?[RED,'EXPIRED']:d<30?[ORANGE,d+'d']:[GOLD,d+'d'];
    return `<tr><td><span class="reg-plate">${x.registration||'—'}</span></td><td><strong>${x.make||''}</strong> ${x.model||''}</td><td>${x.mot||'—'}</td><td><span style="font-weight:800;color:${col}">${lbl}</span></td><td>${x.location||'—'}</td><td>${x.price?fmtGBP(x.price):'—'}</td></tr>`;
  }).join('')||'<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">No MOT alerts in next 60 days</td></tr>';

  // NO PRICE TABLE
  document.getElementById('noPriceBody').innerHTML=noPrice.slice(0,30).map(x=>`<tr>
    <td><span class="reg-plate">${x.registration||'—'}</span></td>
    <td><strong>${x.make||''}</strong> ${x.model||''}</td>
    <td><span style="font-size:11px;padding:3px 8px;border-radius:6px;background:var(--blue-light);color:var(--blue);font-weight:700">${x.status||'—'}</span></td>
    <td>${x.location||'—'}</td><td>${x.fuel||'—'}</td><td>${x.mileage?fmt(x.mileage)+' mi':'—'}</td>
  </tr>`).join('')||'<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">All vehicles have prices set</td></tr>';
}

buildAll();
</script>
<script>
document.addEventListener('DOMContentLoaded',function(){var b=document.getElementById('userBadge');if(b)b.textContent='AUTO CAPITAL';});
function doLogout(){window.location.href='./login.html';}
</script>
</body>
</html>
