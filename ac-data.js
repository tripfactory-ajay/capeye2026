// Auto Capital - CapeEye System Data
// Generated from ClickDealer export - 305 vehicles

const AC_VEHICLES = [{"stockNo":"R0461","registration":"RF66UBC","regDate":"09/12/2016","make":"AUDI","model":"A7","variant":"3.0 TDI V6 ultra S line Sportback S Tronic 220 BHP Euro 6 ULEZ Free","colour":"BLACK","mileage":"95986","body":"Saloon","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":165.0,"mot":"14/11/2026","price":11999.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"11064","registration":"CU21NBO","regDate":"31/03/2021","make":"BMW","model":"R SERIES","variant":"1254cc R 1250 GS ADVENTURE TE 134 BHP","colour":"BLACK","mileage":"0","body":"Not set","doors":"0","fuel":"Petrol","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"31/03/2024","price":5000.0,"status":"In Stock","location":"Stanmore 2"},{"stockNo":"12672","registration":"BP21GYK","regDate":"28/05/2021","make":"BMW","model":"3 SERIES","variant":"2.0 320D SE PRO MHEV 4d AUTO 188 BHP","colour":"BLUE","mileage":"20089","body":"Saloon","doors":"4","fuel":"Elec D","gearbox":"Auto","fsh":"N","rfl":0,"mot":"27/06/2025","price":0.0,"status":"Off-site R","location":"ACL"},{"stockNo":"11332","registration":"LM61YPN","regDate":"10/11/2011","make":"CHEVROLET","model":"SPARK","variant":"1.0 PLUS 70 BHP Petrol","colour":"RED","mileage":"67552","body":"Hatchback","doors":"5","fuel":"Petrol","gearbox":"Manual","fsh":"N","rfl":35.0,"mot":"06/07/2026","price":2990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14245","registration":"WV72CVW","regDate":"30/11/2022","make":"CITROEN","model":"DISPATCH","variant":"1.5 BlueHDi 1000 X Pro M FWD 100 BHP Euro 6 ULEZ Free","colour":"WHITE","mileage":"85928","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"29/11/2026","price":8490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14222","registration":"KJ24ZSO","regDate":"31/07/2024","make":"CITROEN","model":"DISPATCH","variant":"1.5 BlueHDi Driver XL Panel Van 6dr Diesel Manual LWB Euro 6 (s/s) (120 ps)","colour":"WHITE","mileage":"31673","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"31/07/2027","price":0.0,"status":"In Transit","location":"Stanmore Retail"},{"stockNo":"14100","registration":"SY71VVA","regDate":"28/10/2021","make":"CITROEN","model":"BERLINGO","variant":"1.5 BlueHDi 650 Enterprise M Pro Panel Van 5dr Diesel Manual SWB Euro 6 (75 ps)","colour":"WHITE","mileage":"44224","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"27/10/2026","price":0.0,"status":"In Stock","location":"With Supplier"},{"stockNo":"13083","registration":"HK73KKY","regDate":"29/11/2023","make":"FORD","model":"TRANSIT CUSTOM","variant":"2.0 320 Limited EcoBlue Automatic 136 BHP (New Shape) L1 H1 Euro 6 ULEZ Free","colour":"GREY","mileage":"18611","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"28/11/2026","price":23990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13906","registration":"WR72ZGX","regDate":"11/11/2022","make":"FORD","model":"TRANSIT CUSTOM","variant":"2.0 320 EcoBlue Limited Automatic 170 BHP L1 H1 Combi Van Euro ULEZ Free","colour":"BLACK","mileage":"31640","body":"Combi Van","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"Y","rfl":345.0,"mot":"03/12/2026","price":21990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13954","registration":"WV73YRR","regDate":"01/09/2023","make":"FORD","model":"TRANSIT CUSTOM","variant":"2.0 320 Limited EcoBlue Automatic 170 BHP L2 H1 Euro 6 ULEZ Free","colour":"WHITE","mileage":"26564","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"01/09/2026","price":20490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13908","registration":"HX24SVK","regDate":"31/07/2024","make":"FORD","model":"TRANSIT","variant":"2.0 350 EcoBlue Leader Automatic FWD 165 BHP L3 H2 Euro 6 ULEZ Free","colour":"SILVER","mileage":"6895","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"31/07/2027","price":23990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13764","registration":"WN74RSY","regDate":"27/09/2024","make":"FORD","model":"E-Transit Custom","variant":"320 65kWh Sport Automatic 218 BHP (New Shape) L2 H1 Electric Zero-Emission","colour":"BLUE","mileage":"15707","body":"PANEL VAN","doors":"5","fuel":"Electric","gearbox":"Auto","fsh":"N","rfl":0.0,"mot":"27/09/2027","price":24990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13310","registration":"FL19NMA","regDate":"05/03/2019","make":"FORD","model":"FOCUS","variant":"1.0T EcoBoost ST-Line X 125 BHP Petrol Hatchback Euro 6 ULEZ Free","colour":"BLUE","mileage":"78488","body":"Hatchback","doors":"5","fuel":"Petrol","gearbox":"Manual","fsh":"N","rfl":195.0,"mot":"21/04/2026","price":8990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13973","registration":"BT73NNB","regDate":"29/11/2023","make":"ISUZU","model":"D-MAX","variant":"1.9 TD DL20 Pickup Double Cab 165 BHP 4WD Euro 6 ULEZ Free","colour":"BLACK","mileage":"22458","body":"PICKUP","doors":"4","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"29/11/2026","price":23990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"R0465","registration":"RO75HDV","regDate":"30/09/2025","make":"KGM","model":"MUSSO","variant":"2.2D Rebel 4WD 202 BHP Double Cab Pickup Euro 6 ULEZ Free","colour":"BLACK","mileage":"22","body":"PICKUP","doors":"4","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"30/09/2028","price":24990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"R0466","registration":"RO75HFH","regDate":"30/09/2025","make":"KGM","model":"MUSSO","variant":"2.2D Saracen 4WD Automatic 202 BHP Double Cab Pickup Euro 6 ULEZ Free","colour":"GREEN","mileage":"11","body":"PICKUP","doors":"4","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"30/09/2028","price":26750.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14326","registration":"MF22RBX","regDate":"11/05/2022","make":"MAXUS","model":"EDELIVER 9","variant":"72kWh Automatic 204 BHP L3 H2 Fully Electric Zero-emission","colour":"WHITE","mileage":"4316","body":"PANEL VAN","doors":"5","fuel":"Electric","gearbox":"Auto","fsh":"N","rfl":0.0,"mot":"29/06/2026","price":17990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13649","registration":"LR71KYU","regDate":"06/10/2021","make":"MAXUS","model":"EDELIVER 3","variant":"52 kWh Automatic 122 BHP L1 SWB Fully Electric Zero-emission","colour":"WHITE","mileage":"18838","body":"PANEL VAN","doors":"5","fuel":"Electric","gearbox":"Auto","fsh":"N","rfl":0.0,"mot":"05/10/2026","price":7990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"12802","registration":"KN72PUK","regDate":"08/09/2022","make":"MERCEDES-BENZ","model":"SPRINTER","variant":"2.0 315 CDI PREMIUM FWD 150 BHP L2 H2 Euro 6 ULEZ Free","colour":"SILVER","mileage":"28720","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"07/07/2026","price":22990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13992","registration":"YC72VUO","regDate":"24/10/2022","make":"MERCEDES-BENZ","model":"SPRINTER","variant":"2.0 315 CDI PREMIUM RWD 150 BHP L3 H2 Euro 6 ULEZ Free","colour":"WHITE","mileage":"32595","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"11/01/2027","price":25990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14260","registration":"NL71WCJ","regDate":"28/10/2021","make":"MERCEDES-BENZ","model":"VITO","variant":"2.0 114 CDI Progressive G-Tronic RWD 136 BHP L2 LWB Euro 6 ULEZ Compliant","colour":"WHITE","mileage":"85759","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"28/10/2026","price":12990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13341","registration":"GY69WNR","regDate":"18/11/2019","make":"MERCEDES-BENZ","model":"A-CLASS","variant":"2.0 A35 AMG Premium SpdS DCT 4MATIC 306 BHP Petrol Hatchback Euro 6 ULEZ Free","colour":"BLUE","mileage":"47188","body":"Hatchback","doors":"5","fuel":"Petrol","gearbox":"Auto","fsh":"N","rfl":0,"mot":"25/11/2026","price":21990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14201","registration":"YH73VXM","regDate":"30/10/2023","make":"NISSAN","model":"TOWNSTAR","variant":"1.3 TCe Acenta 130 BHP Petrol SWB L1 Euro 6 ULEZ Free","colour":"GREY","mileage":"8984","body":"PANEL VAN","doors":"6","fuel":"Petrol","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"06/10/2026","price":13790.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14150","registration":"MD22EEO","regDate":"30/06/2022","make":"PEUGEOT","model":"BOXER","variant":"2.2 BlueHDi 435 Professional 140 BHP L4 H2 Euro 6 ULEZ free","colour":"WHITE","mileage":"56633","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"01/10/2026","price":13990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14298","registration":"KS74LHM","regDate":"31/10/2024","make":"PEUGEOT","model":"EXPERT","variant":"1.5 BlueHDi Asphalt 120 BHP LWB Euro 6 ULEZ Compliant","colour":"WHITE","mileage":"13819","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"31/10/2027","price":19990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13626","registration":"HN16NNL","regDate":"31/03/2016","make":"RENAULT","model":"CLIO","variant":"0.9 TCe Dynamique Nav 90 BHP Petrol Hatchback Euro 6 ULEZ Free","colour":"RED","mileage":"80000","body":"Hatchback","doors":"5","fuel":"Petrol","gearbox":"Manual","fsh":"N","rfl":20.0,"mot":"12/08/2026","price":3490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"13898","registration":"CV22ODG","regDate":"25/05/2022","make":"TOYOTA","model":"PROACE CITY","variant":"1.5 BlueHDi Active 100 BHP SWB Euro 6 ULEZ Free","colour":"WHITE","mileage":"103207","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"24/05/2026","price":6990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14144","registration":"DV71JCJ","regDate":"25/10/2021","make":"VAUXHALL","model":"MOVANO","variant":"2.3 CDTi 3500 BiTurbo Edition FWD 135 BHP L3 H2 Euro 6 ULEZ Free","colour":"WHITE","mileage":"82178","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"20/07/2026","price":8490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14194","registration":"DY21JZD","regDate":"31/03/2021","make":"VAUXHALL","model":"COMBO","variant":"1.5 Turbo D 2300 Dynamic 100 BHP L2 H1 Euro 6 ULEZ Free","colour":"WHITE","mileage":"44762","body":"PANEL VAN","doors":"6","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"02/02/2027","price":10490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"R0463","registration":"GY73NDN","regDate":"03/01/2024","make":"VOLKSWAGEN","model":"TRANSPORTER","variant":"2.0 TDI T30 Startline 110 BHP SWB Euro 6 ULEZ Free","colour":"GREY","mileage":"31157","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"03/01/2027","price":19990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14029","registration":"LX23CKC","regDate":"22/05/2023","make":"VOLKSWAGEN","model":"CRAFTER","variant":"2.0 TDI CR35 Trendline Automatic FWD 140 BHP LWB High Roof Euro 6 ULEZ Free","colour":"WHITE","mileage":"113626","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"22/05/2026","price":18990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14187","registration":"FE72ZKD","regDate":"31/10/2022","make":"VOLKSWAGEN","model":"CRAFTER","variant":"2.0 TDI CR35 Trendline FWD 140 BHP MWB Euro 6 ULEZ Compliant","colour":"WHITE","mileage":"51419","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"05/01/2027","price":18990.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"14249","registration":"FN72OOU","regDate":"28/12/2022","make":"VOLKSWAGEN","model":"CADDY","variant":"2.0 TDI C20 Commerce 102 BHP SWB Euro 6 ULEZ Compliant","colour":"WHITE","mileage":"43582","body":"PANEL VAN","doors":"5","fuel":"Diesel","gearbox":"Manual","fsh":"N","rfl":345.0,"mot":"27/12/2026","price":12490.0,"status":"In Stock","location":"Stanmore Retail"},{"stockNo":"R0478","registration":"AE74VYX","regDate":"30/09/2024","make":"VOLKSWAGEN","model":"AMAROK","variant":"2.0 TDI Life Pickup Double Cab Automatic 4WD 205 BHP 4Motion Euro 6 ULEZ Free","colour":"BLACK","mileage":"18520","body":"PICKUP","doors":"4","fuel":"Diesel","gearbox":"Auto","fsh":"N","rfl":345.0,"mot":"30/09/2027","price":25990.0,"status":"In Stock","location":"Stanmore Retail"}];

const AC_STAFF = [
  {name:"Sol Adam",        role:"CEO",                    dept:"Management"},
  {name:"Ali Amood",       role:"CEO",                    dept:"Management"},
  {name:"Keith Hardy",     role:"General Manager",        dept:"Management"},
  {name:"Ibrahim Ata",     role:"Sales Manager",          dept:"Sales"},
  {name:"Ali Soliemani",   role:"Showroom Manager",       dept:"Sales"},
  {name:"Germaine Dua",    role:"Sales",                  dept:"Sales"},
  {name:"Haider Ahmed",    role:"Sales",                  dept:"Sales"},
  {name:"Moamel Al Ameri", role:"Sales",                  dept:"Sales"},
  {name:"Ismael Al Ameri", role:"Advertising",            dept:"Marketing"},
  {name:"Mustafa Naama",   role:"Advertising",            dept:"Marketing"},
  {name:"Abu Amarts",      role:"Accounts",               dept:"Finance"},
  {name:"Morteza Rahamian",role:"Mechanic",               dept:"Workshop"},
  {name:"Marcin Kiljan",   role:"Mechanic",               dept:"Workshop"},
  {name:"Sia Vajihi",      role:"Mechanic",               dept:"Workshop"},
  {name:"Iman Zarien",     role:"Mechanic",               dept:"Workshop"},
  {name:"Gorgino Barnes",  role:"Valeting",               dept:"Valeting"},
  {name:"Stanslaw Marzec", role:"Pre Inspection / Intake",dept:"Intake"}
];

const AC_DEPARTMENTS = [
  {name:"Management", icon:"ðŸ‘”", color:"#64748b"},
  {name:"Sales",      icon:"ðŸ¤", color:"#3b7ff5"},
  {name:"Workshop",   icon:"ðŸ”§", color:"#ef4444"},
  {name:"Valeting",   icon:"ðŸ§¹", color:"#10b981"},
  {name:"Marketing",  icon:"ðŸ“¢", color:"#8b5cf6"},
  {name:"Finance",    icon:"ðŸ’°", color:"#a855f7"},
  {name:"Bodyshop",   icon:"ðŸŽ¨", color:"#f97316"},
  {name:"Intake",     icon:"ðŸ“‹", color:"#6366f1"}
];

const AC_LOCATIONS = ["Main Yard","Showroom","With Supplier","Workshop - Bay 1","Workshop - Bay 2","Workshop - Bay 3","Workshop - Bay 4","Workshop - Bay 5","Workshop - Bay 6","Valeting","Bodywork","Jay - Detailing","External Tyre Shop","External Garage","MOT Centre","Stanmore Retail","Stanmore 2","Stanmore PDI","Non-Driveable"];

const AC_FAULTS = ["Engine Fault","Transmission / Gearbox Fault","Clutch Fault","Brakes Fault","Suspension Fault","Steering Fault","Electrical Fault","Battery / Charging Fault","Exhaust / Emissions Fault","DPF / AdBlue Fault","Cooling System Fault","Air Conditioning Fault","Fuel System Fault","Turbocharger Fault","Drivetrain / Differential Fault","Bodywork / Corrosion","Locks / Security / Keys","Lighting Fault","Interior / Trim Fault","Tyres / Wheels Fault","General Maintenance / Service","Other / Unknown Fault"];

const AC_REPAIRS = ["Inspection Only","Adjust / Calibrate","Clean","Lubricate","Replace Part","Repair Part","Software Update / Reset","Recharge / Refill Fluid","Road Test","Remove & Refit","Upgrade / Retrofit","Outsource Repair"];

const AC_PARTS = ["Air Filter","Cabin / Pollen Filter","Fuel Filter","Oil Filter","Timing Belt / Cambelt","Timing Chain","Drive Belt / Serpentine Belt","Alternator Belt","Spark Plug","Glow Plug","Ignition Coil","Battery","Starter Motor","Alternator","Turbocharger","Intercooler","Radiator","Coolant Expansion Tank","Water Pump","Thermostat","Brake Pads","Brake Discs","Caliper","Wheel Bearing","CV Joint","Driveshaft","Shock Absorber","Spring","Tie Rod","Ball Joint","Steering Rack","Power Steering Pump","Clutch Kit","Flywheel","Gearbox Oil","Engine Oil","Coolant","Brake Fluid","Tyres"];

const AC_WORKFLOW_STAGES = [
  {id:1,  name:'Intake',        dept:'Intake',      color:'#6366f1', handoverTo:'Workshop'},
  {id:2,  name:'Bodywork',      dept:'Bodyshop',    color:'#f59e0b', handoverTo:'Bodyshop'},
  {id:3,  name:'Paint',         dept:'Bodyshop',    color:'#f97316', handoverTo:'Workshop'},
  {id:4,  name:'Legal & Docs',  dept:'Management',  color:'#8b5cf6', handoverTo:'Workshop'},
  {id:5,  name:'Mechanical',    dept:'Workshop',    color:'#ef4444', handoverTo:'Workshop'},
  {id:6,  name:'External Work', dept:'Workshop',    color:'#dc2626', handoverTo:'Valeting'},
  {id:7,  name:'Valeting',      dept:'Valeting',    color:'#10b981', handoverTo:'Workshop'},
  {id:8,  name:'Fault Overview',dept:'Workshop',    color:'#06b6d4', handoverTo:'Marketing'},
  {id:9,  name:'Advertising',   dept:'Marketing',   color:'#3b82f6', handoverTo:'Sales'},
  {id:10, name:'Delivery Prep', dept:'Sales',       color:'#84cc16', handoverTo:'Finance'},
  {id:11, name:'Accounts',      dept:'Finance',     color:'#a855f7', handoverTo:'Management'},
  {id:12, name:'Management',    dept:'Management',  color:'#64748b', handoverTo:null}
];

// â”€â”€â”€ localStorage helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getVehicles() {
  try { const s = JSON.parse(localStorage.getItem('ac_vehicles')||'[]'); return s.length ? s : AC_VEHICLES; }
  catch(e) { return AC_VEHICLES; }
}
function saveVehicles(v) { localStorage.setItem('ac_vehicles', JSON.stringify(v)); }
function getWorkflow(stockNo) { return JSON.parse(localStorage.getItem('ac_wf_'+stockNo)||'{}'); }
function saveWorkflow(stockNo, data) { localStorage.setItem('ac_wf_'+stockNo, JSON.stringify(data)); }

// â”€â”€â”€ Handover / task queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveHandover(stockNo, stageId, data) {
  localStorage.setItem('ac_ho_'+stockNo+'_'+stageId, JSON.stringify({...data, ts: new Date().toISOString()}));
}
function getHandover(stockNo, stageId) {
  return JSON.parse(localStorage.getItem('ac_ho_'+stockNo+'_'+stageId)||'null');
}
function assignTask(staffName, stockNo, stageId, stageName, note, vehicle) {
  const key = 'ac_tasks_'+staffName.replace(/\s/g,'_');
  const tasks = JSON.parse(localStorage.getItem(key)||'[]');
  tasks.unshift({id:Date.now(), stockNo, stageId, stageName, note, vehicle, assignedAt:new Date().toISOString(), status:'pending'});
  localStorage.setItem(key, JSON.stringify(tasks));
  // Also log to global alert feed
  addAlert({type:'handover', level:'info',
    title:`${stageName} complete â€” handover to ${staffName}`,
    body:`${vehicle?.registration||stockNo} Â· ${vehicle?.make||''} ${vehicle?.model||''} Â· ${note||'No note'}`,
    stockNo});
}
function getMyTasks(staffName) {
  return JSON.parse(localStorage.getItem('ac_tasks_'+staffName.replace(/\s/g,'_'))||'[]');
}
function completeTask(staffName, taskId) {
  const key = 'ac_tasks_'+staffName.replace(/\s/g,'_');
  const tasks = JSON.parse(localStorage.getItem(key)||'[]');
  localStorage.setItem(key, JSON.stringify(tasks.map(t => t.id===taskId ? {...t, status:'done', completedAt:new Date().toISOString()} : t)));
}

// â”€â”€â”€ Alerts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAlerts() { return JSON.parse(localStorage.getItem('ac_alerts')||'[]'); }
function addAlert(alert) {
  const alerts = getAlerts();
  alerts.unshift({...alert, id:Date.now(), ts:new Date().toISOString(), read:false});
  localStorage.setItem('ac_alerts', JSON.stringify(alerts.slice(0,300)));
}
function markAlertRead(id) {
  localStorage.setItem('ac_alerts', JSON.stringify(getAlerts().map(a => a.id===id?{...a,read:true}:a)));
}
function markAllAlertsRead() {
  localStorage.setItem('ac_alerts', JSON.stringify(getAlerts().map(a => ({...a,read:true}))));
}

// â”€â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatGBP(n) {
  return new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP',maximumFractionDigits:0}).format(n||0);
}
function daysSince(dateStr) {
  if (!dateStr) return 0;
  const parts = dateStr.split('/');
  if (parts.length!==3) return 0;
  return Math.floor((Date.now()-new Date(parts[2],parts[1]-1,parts[0]).getTime())/86400000);
}
function hoursInStage(stockNo, stageId) {
  const stage = getWorkflow(stockNo)[stageId];
  if (!stage || !stage.startedAt) return 0;
  return Math.floor((Date.now()-new Date(stage.startedAt).getTime())/3600000);
}
